<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>libmoost: /home/mhx/git/github/libmoost/include/moost/guarded_ptr.hpp File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">libmoost
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('guarded__ptr_8hpp.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#namespaces">Namespaces</a>  </div>
  <div class="headertitle">
<div class="title">/home/mhx/git/github/libmoost/include/moost/guarded_ptr.hpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>scoped pointer paired with a mutex  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;cassert&gt;</code><br/>
<code>#include &lt;boost/noncopyable.hpp&gt;</code><br/>
<code>#include &lt;boost/scoped_ptr.hpp&gt;</code><br/>
<code>#include &lt;boost/thread/shared_mutex.hpp&gt;</code><br/>
<code>#include &lt;boost/thread/locks.hpp&gt;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for guarded_ptr.hpp:</div>
<div class="dyncontent">
<div class="center"><img src="guarded__ptr_8hpp__incl.png" border="0" usemap="#_2home_2mhx_2git_2github_2libmoost_2include_2moost_2guarded__ptr_8hpp" alt=""/></div>
</div>
</div>
<p><a href="guarded__ptr_8hpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmoost_1_1guarded__ptr.html">moost::guarded_ptr&lt; T &gt;</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Wrapper around shared_ptr that guards the referenced object with a mutex.  <a href="classmoost_1_1guarded__ptr.html#details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmoost_1_1guarded__ptr_1_1shared__access.html">moost::guarded_ptr&lt; T &gt;::shared_access</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Objects of this class represent a shared lock of the <a class="el" href="classmoost_1_1guarded__ptr.html" title="Wrapper around shared_ptr that guards the referenced object with a mutex.">guarded_ptr</a>'s mutex.  <a href="classmoost_1_1guarded__ptr_1_1shared__access.html#details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmoost_1_1guarded__ptr_1_1exclusive__access.html">moost::guarded_ptr&lt; T &gt;::exclusive_access</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Objects of this class represent an exclusive lock of the <a class="el" href="classmoost_1_1guarded__ptr.html" title="Wrapper around shared_ptr that guards the referenced object with a mutex.">guarded_ptr</a>'s mutex.  <a href="classmoost_1_1guarded__ptr_1_1exclusive__access.html#details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmoost_1_1guarded__ptr_1_1upgradable__access.html">moost::guarded_ptr&lt; T &gt;::upgradable_access</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Objects of this class represent an upgradable lock of the <a class="el" href="classmoost_1_1guarded__ptr.html" title="Wrapper around shared_ptr that guards the referenced object with a mutex.">guarded_ptr</a>'s mutex.  <a href="classmoost_1_1guarded__ptr_1_1upgradable__access.html#details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmoost_1_1guarded__ptr_1_1upgradable__access_1_1upgrade.html">moost::guarded_ptr&lt; T &gt;::upgradable_access::upgrade</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Objects of this class represent an upgrade of an upgradable lock.  <a href="classmoost_1_1guarded__ptr_1_1upgradable__access_1_1upgrade.html#details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">namespace &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemoost.html">moost</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight"><p>Creates a unique temporary directory; removed on scope exit. </p>
<br/></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>scoped pointer paired with a mutex </p>
<p>Copyright Â© 2008-2013 Last.fm Limited</p>
<p>This file is part of libmoost.</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>
<p>If objects of type 'foo' are not inherently thread-safe to use, a guarded_ptr can be used to add locking around the foo object. A guarded_ptr cannot make any arbitrary object automagically thread-safe, but it pairs the pointer to the object with a mutex and only gives you access to the object while you are holding a lock. The developer still needs to know what locks (shared or exclusive) are necessary to carry out operations on the object. Shared locks will only grant you access to a const-reference of the object.</p>
<p>Also, just like with other smart pointers, you need to follow some rules in order to benefit from the smartness. There are certainly ways to obtain a pointer to the original object through some methods. Saving such a pointer and using it in other places will undermine the benefits. (As it would if you did the same for e.g. a shared_ptr.)</p>
<div class="fragment"><pre class="fragment"> <a class="code" href="classmoost_1_1guarded__ptr.html" title="Wrapper around shared_ptr that guards the referenced object with a mutex.">moost::guarded_ptr&lt;foo&gt;</a> bar(<span class="keyword">new</span> foo);
</pre></div><p>The guarded_ptr object has no methods to call. Upon destruction it will take of destruction of the foo object.</p>
<p>To use the object referenced by bar, a lock must be acquired.</p>
<div class="fragment"><pre class="fragment"> <a class="code" href="classmoost_1_1guarded__ptr_1_1shared__access.html" title="Objects of this class represent a shared lock of the guarded_ptr&#39;s mutex.">moost::guarded_ptr&lt;foo&gt;::shared_access</a> barlock(bar);
 barlock-&gt;some_const_method_of_foo();
</pre></div><p>The lock is kept until barlock runs out of scope. The shared_access object keeps are shared lock of the mutex in the guarded_ptr object. shared_access implements operator* and operator-&gt;, which both return a const-pointer to the underlying foo object. If you need to call non-const methods, you will have to acquire an exclusive lock, for which a class exclusive_lock exists.</p>
<div class="fragment"><pre class="fragment"> <a class="code" href="classmoost_1_1guarded__ptr_1_1exclusive__access.html" title="Objects of this class represent an exclusive lock of the guarded_ptr&#39;s mutex.">moost::guarded_ptr&lt;foo&gt;::exclusive_access</a> barlock(bar);
 barlock-&gt;some_method_of_foo();
</pre></div><p>The exclusive_access class works much like shared_access, but it acquires a full, exclusive lock of the mutex within guarded_ptr. It allows to call const and non-const methods of the underlying object.</p>
<p>There is also an upgradable_access class.</p>
<div class="fragment"><pre class="fragment"> <a class="code" href="classmoost_1_1guarded__ptr_1_1upgradable__access.html" title="Objects of this class represent an upgradable lock of the guarded_ptr&#39;s mutex.">moost::guarded_ptr&lt;foo&gt;::upgradable_access</a> barlock(bar);
 barlock-&gt;some_const_method_of_foo();
 <a class="code" href="classmoost_1_1guarded__ptr_1_1upgradable__access_1_1upgrade.html" title="Objects of this class represent an upgrade of an upgradable lock.">moost::guarded_ptr&lt;foo&gt;::upgradable_access::upgrade</a> barlock2(barlock);
 barlock2-&gt;some_method_of_foo();
</pre></div><p>The upgradable_access constructor acquires an upgradable lock. It secures shared access to the object which can later be upgraded to exclusive access. The upgradable_access object itself only yields const-pointers to the underlying object, but an upgrade object can be constructed from it, which then also offers non-const pointers. Upon construction of the (first) upgrade object from an upgradable_access object, the lock held by upgradable_access is promoted to an exclusive lock.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>Objects of types shared_access, exclusive_access, upgradable_access and upgrade must never outlive the objects they were created from. </dd></dl>

<p>Definition in file <a class="el" href="guarded__ptr_8hpp_source.html">guarded_ptr.hpp</a>.</p>
</div></div><!-- contents -->
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="guarded__ptr_8hpp.html">guarded_ptr.hpp</a>      </li>

    <li class="footer">Generated on Wed Feb 20 2013 05:56:09 for libmoost by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
